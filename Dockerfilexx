

# FROM emersonml/ruby
# RUN apt-get update -qq && apt-get install -y nodejs

FROM ubuntu:16.04
LABEL maintainer="Emerson Marques"

RUN apt-get update
RUN apt-get install -y openssh-server vim curl git sudo

RUN apt-get update
RUN apt-get install -y build-essential automake autoconf \
    bison libssl-dev libyaml-dev libreadline6-dev \
    zlib1g-dev libncurses5-dev libffi-dev libgdbm-dev \
    gawk g++ gcc make libc6-dev patch libsqlite3-dev sqlite3 \
    libtool pkg-config libpq-dev nodejs ruby-full

RUN mkdir /home/app
RUN mkdir /var/run/sshd

WORKDIR /home/app

RUN echo 'root:root' |chpasswd
RUN sed -ri 's/^PermitRootLogin\s+.*/PermitRootLogin yes/' /etc/ssh/sshd_config
RUN sed -ri 's/UsePAM yes/#UsePAM yes/g' /etc/ssh/sshd_config
# RUN echo 'Banner /etc/banner' >> /etc/ssh/sshd_config

# COPY etc/banner /etc/

RUN useradd -ms /bin/bash app
RUN adduser app sudo
RUN echo 'app:app' |chpasswd

USER root


# COPY Gemfile /home/app/projects/webcoruja/Gemfile
# COPY Gemfile.lock /home/app/projects/webcoruja/Gemfile.lock

### Alternatively you might want to import keys directly from our web server, although this is a less secure way:
RUN /bin/bash -l -c "curl -sSL https://rvm.io/mpapis.asc | gpg2 --import -"
RUN /bin/bash -l -c "curl -sSL https://rvm.io/pkuczynski.asc | gpg2 --import -"

RUN /bin/bash -l -c "gpg --keyserver keyserver.ubuntu.com --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB"
# RUN /bin/bash -l -c "gpg --keyserver hkp://pgp.mit.edu --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB"
RUN /bin/bash -l -c "curl -sSL https://get.rvm.io | bash -s stable"

# USER app

RUN /bin/bash -l -c "rvm install 3.0.0"
# RUN /bin/bash -l -c "rvm install"

RUN /bin/bash -l -c "gem install bundler -v 2.2.25"
RUN /bin/bash -l -c "gem install rails -v 6.1.6"



# Add a script to be executed every time the container starts.
# COPY entrypoint.sh /usr/bin/
# RUN chmod +x /usr/bin/entrypoint.sh
# ENTRYPOINT ["entrypoint.sh"]



EXPOSE 22
EXPOSE 3000

VOLUME /home/app


# Configure the main process to run when running the image
# CMD ["rails", "server", "-b", "0.0.0.0"]